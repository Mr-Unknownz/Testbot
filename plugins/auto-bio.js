const fs = require("fs");
const path = require("path");
const moment = require("moment-timezone");
const { cmd } = require("../lib/command");
const config = require("../settings/settings.json");

const lifeQuotes = [
  // English Quotes
  "ðŸ’– á´›Êœá´‡ á´É´ÊŸÊ á´¡á´€Ê á´›á´ á´…á´ É¢Ê€á´‡á´€á´› á´¡á´Ê€á´‹ Éªêœ± á´›á´ ÊŸá´á´ á´‡ á´¡Êœá´€á´› Êá´á´œ á´…á´.",
  "ðŸŒŸ êœ±á´›Ê€Éªá´ á´‡ É´á´á´› á´›á´ Ê™á´‡ á´€ êœ±á´œá´„á´„á´‡êœ±êœ±, Ê™á´œá´› Ê€á´€á´›Êœá´‡Ê€ á´›á´ Ê™á´‡ á´êœ° á´ á´€ÊŸá´œá´‡.",
  "ðŸ§  á´›Êœá´‡ á´ÉªÉ´á´… Éªêœ± á´‡á´ á´‡Ê€Êá´›ÊœÉªÉ´É¢. á´¡Êœá´€á´› Êá´á´œ á´›ÊœÉªÉ´á´‹, Êá´á´œ Ê™á´‡á´„á´á´á´‡.",
  "ðŸš€ Ê™á´‡ÊŸÉªá´‡á´ á´‡ Êá´á´œ á´„á´€É´ á´€É´á´… Êá´á´œ'Ê€á´‡ Êœá´€ÊŸêœ°á´¡á´€Ê á´›Êœá´‡Ê€á´‡.",
  "ðŸŒŒ á´›Êœá´‡ êœ°á´œá´›á´œÊ€á´‡ Ê™á´‡ÊŸá´É´É¢êœ± á´›á´ á´›Êœá´êœ±á´‡ á´¡Êœá´ Ê™á´‡ÊŸÉªá´‡á´ á´‡ ÉªÉ´ á´›Êœá´‡ÉªÊ€ á´…Ê€á´‡á´€á´êœ±.",
  "â³ Éªá´› Éªêœ± É´á´‡á´ á´‡Ê€ á´›á´á´ ÊŸá´€á´›á´‡ á´›á´ Ê™á´‡ á´¡Êœá´€á´› Êá´á´œ á´ÉªÉ¢Êœá´› Êœá´€á´ á´‡ Ê™á´‡á´‡É´.",
  "ðŸ”¥ á´á´€á´‹á´‡ á´›Êœá´‡ ÉªÊ€á´É´ Êœá´á´› Ê™Ê êœ±á´›Ê€Éªá´‹ÉªÉ´É¢!",
  "ðŸŽ¨ á´›Êœá´‡ Ê™á´‡êœ±á´› á´¡á´€Ê á´›á´ á´˜Ê€á´‡á´…Éªá´„á´› á´›Êœá´‡ êœ°á´œá´›á´œÊ€á´‡ Éªêœ± á´›á´ á´„Ê€á´‡á´€á´›á´‡ Éªá´›.",
  "ðŸ‘£ á´›Êœá´‡ á´Šá´á´œÊ€É´á´‡Ê á´êœ° á´€ á´›Êœá´á´œêœ±á´€É´á´… á´ÉªÊŸá´‡êœ± Ê™á´‡É¢ÉªÉ´êœ± á´¡Éªá´›Êœ á´É´á´‡ êœ±á´›á´‡á´˜.",
  "ðŸ˜Š Êœá´€á´˜á´˜ÉªÉ´á´‡êœ±êœ± á´„á´á´á´‡êœ± êœ°Ê€á´á´ Êá´á´œÊ€ á´á´¡É´ á´€á´„á´›Éªá´É´êœ±.",
  "ðŸ–¤ á´€ÊŸá´¡á´€Êêœ± á´‹ÉªÉ´É¢ ÉªÉ´ á´›Êœá´‡ É¢á´€á´á´‡.",
  "ðŸ˜ Éª á´€á´ á´›Êœá´‡ á´€Ê€á´›Éªêœ±á´› á´¡Êœá´ á´˜á´€ÉªÉ´á´›êœ± á´Ê ÊŸÉªêœ°á´‡.",
  "â˜¸ Éª Ê™á´‡ÊŸÉªá´‡á´ á´‡ ÉªÉ´ á´‹á´€Ê€á´á´€.",
  "âš¡ Éª á´…á´É´â€™á´› á´¡á´€Éªá´› êœ°á´Ê€ á´á´˜á´˜á´Ê€á´›á´œÉ´Éªá´›Éªá´‡êœ±, Éª á´„Ê€á´‡á´€á´›á´‡ á´›Êœá´‡á´.",
  "ðŸŽ¯ êœ°á´á´„á´œêœ± á´É´ É¢á´á´€ÊŸêœ±, É´á´á´› á´Ê™êœ±á´›á´€á´„ÊŸá´‡êœ±.",
  "ðŸŒ¹ êœ±ÉªÊŸá´‡É´á´„á´‡ Éªêœ± Ê™á´‡á´›á´›á´‡Ê€ á´›Êœá´€É´ á´œÉ´É´á´‡á´„á´‡êœ±êœ±á´€Ê€Ê á´…Ê€á´€á´á´€.",
  "ðŸ‘‘ Ê™á´Ê€É´ á´›á´ á´‡xá´˜Ê€á´‡êœ±êœ±, É´á´á´› á´›á´ Éªá´á´˜Ê€á´‡êœ±êœ±.",
  "ðŸ”¥ Êœá´œêœ±á´›ÊŸá´‡ ÉªÉ´ êœ±ÉªÊŸá´‡É´á´„á´‡, ÊŸá´‡á´› êœ±á´œá´„á´„á´‡êœ±êœ± á´á´€á´‹á´‡ á´›Êœá´‡ É´á´Éªêœ±á´‡.",
  "ðŸŒˆ á´‡á´ á´‡Ê€Ê á´…á´€Ê Éªêœ± á´€ É´á´‡á´¡ Ê™á´‡É¢ÉªÉ´É´ÉªÉ´É¢.",
  "ðŸ¦… êœ°ÊŸÊ ÊœÉªÉ¢Êœ, É´á´ ÊŸÉªá´Éªá´›êœ±.",
  "ðŸ’Ž á´˜Ê€á´‡êœ±êœ±á´œÊ€á´‡ á´„Ê€á´‡á´€á´›á´‡êœ± á´…Éªá´€á´á´É´á´…êœ±.",
  "ðŸŒŠ É¢á´ á´¡Éªá´›Êœ á´›Êœá´‡ êœ°ÊŸá´á´¡, Ê™á´œá´› á´‹á´‡á´‡á´˜ Êá´á´œÊ€ É¢á´á´€ÊŸêœ±.",
  "â˜ ï¸ Éª êœ°á´‡á´€Ê€ É´á´É´á´‡, Éª Ê€á´‡êœ±á´˜á´‡á´„á´› á´€ÊŸÊŸ.",
  "âš”ï¸ á´¡á´€Ê€Ê€Éªá´Ê€êœ± á´€Ê€á´‡ É´á´á´› Ê™á´Ê€É´, á´›Êœá´‡Ê á´€Ê€á´‡ Ê™á´œÉªÊŸá´›.",
  "ðŸ“Œ êœ±á´œá´„á´„á´‡êœ±êœ± Éªêœ± É´á´á´› êœ°á´Ê€ á´›Êœá´‡ ÊŸá´€á´¢Ê.",
  "ðŸ•Šï¸ á´˜á´‡á´€á´„á´‡ á´á´ á´‡Ê€ á´‡á´ á´‡Ê€Êá´›ÊœÉªÉ´É¢.",
  "ðŸŒ Ê™á´‡ á´›Êœá´‡ Ê€á´‡á´€êœ±á´É´ êœ±á´á´á´‡á´É´á´‡ êœ±á´ÉªÊŸá´‡êœ± á´›á´á´…á´€Ê.",
  "ðŸ”¥ á´˜á´€ÉªÉ´ á´á´€á´‹á´‡êœ± Êá´á´œ êœ±á´›Ê€á´É´É¢á´‡Ê€.",
  "ðŸ’« á´…Ê€á´‡á´€á´ Ê™ÉªÉ¢, á´¡á´Ê€á´‹ Êœá´€Ê€á´…, êœ±á´›á´€Ê Êœá´œá´Ê™ÊŸá´‡.",
  "âš¡ á´˜á´á´¡á´‡Ê€ Éªêœ± É¢Éªá´ á´‡É´ á´›á´ á´›Êœá´êœ±á´‡ á´¡Êœá´ á´…á´€Ê€á´‡.",
  "ðŸŒ™ á´‡á´ á´‡Ê€Ê É´ÉªÉ¢Êœá´› Ê™Ê€ÉªÉ´É¢êœ± á´€ É´á´‡á´¡ á´›Êœá´á´œÉ¢Êœá´›.",
  "ðŸ”¥ É¢Ê€ÉªÉ´á´… á´œÉ´á´›ÉªÊŸ Êá´á´œ É´á´ ÊŸá´É´É¢á´‡Ê€ Êœá´€á´ á´‡ á´›á´ ÉªÉ´á´›Ê€á´á´…á´œá´„á´‡ Êá´á´œÊ€êœ±á´‡ÊŸêœ°.",
  "ðŸ¦‹ á´„Êœá´€É´É¢á´‡ Éªêœ± Ê™á´‡á´€á´œá´›Éªêœ°á´œÊŸ á´¡Êœá´‡É´ Êá´á´œ á´€á´„á´„á´‡á´˜á´› Éªá´›.",
  "ðŸŒ¤ï¸ á´€ á´˜á´êœ±Éªá´›Éªá´ á´‡ á´ÉªÉ´á´… á´„Ê€á´‡á´€á´›á´‡êœ± á´€ á´˜á´êœ±Éªá´›Éªá´ á´‡ ÊŸÉªêœ°á´‡.",
  "ðŸ‘‘ á´€ á´‹ÉªÉ´É¢ É´á´‡á´ á´‡Ê€ ÊŸá´êœ±á´‡êœ±, Êœá´‡ ÊŸá´‡á´€Ê€É´êœ±.",
  "ðŸ§© ÊŸÉªêœ°á´‡ Éªêœ± á´€ á´˜á´œá´¢á´¢ÊŸá´‡, êœ±á´ÊŸá´ á´‡ Éªá´› á´˜Éªá´‡á´„á´‡ Ê™Ê á´˜Éªá´‡á´„á´‡.",
  "ðŸ›¡ï¸ Ê™á´‡ Êá´á´œÊ€ á´á´¡É´ á´˜Ê€á´á´›á´‡á´„á´›Éªá´É´.",
  "ðŸŒ± É¢Ê€á´á´¡á´›Êœ Êœá´€á´˜á´˜á´‡É´êœ± á´á´œá´›êœ±Éªá´…á´‡ Êá´á´œÊ€ á´„á´á´êœ°á´Ê€á´› á´¢á´É´á´‡.",
  "âœ¨ Êá´á´œÊ€ á´ ÉªÊ™á´‡ á´€á´›á´›Ê€á´€á´„á´›êœ± Êá´á´œÊ€ á´›Ê€ÉªÊ™á´‡.",
  "âš”ï¸ êœ±á´›Ê€á´É´É¢ á´ÉªÉ´á´…êœ± ê¯±Ê€á´‡ á´á´€á´…á´‡ á´›ÊœÊ€á´á´œÉ¢Êœ á´›á´á´œÉ¢Êœ á´¡á´€Ê€êœ±.",
  "ðŸ’­ á´›ÊœÉªÉ´á´‹ ÊŸá´‡êœ±êœ±, ÊŸÉªá´ á´‡ á´á´Ê€á´‡.",
  "ðŸŒ‹ á´€ êœ±á´›á´Ê€á´ á´á´€á´‹á´‡êœ± êœ±á´›Ê€á´É´É¢á´‡Ê€ á´¡á´€Ê€Ê€Éªá´Ê€êœ±.",
  "ðŸ”® Êá´á´œÊ€ êœ°á´œá´›á´œÊ€á´‡ Éªêœ± á´€ÊŸÊ€á´‡á´€á´…Ê á´˜Ê€á´‡á´˜á´€Ê€ÉªÉ´É¢ êœ°á´Ê€ Êá´á´œ.",
  "ðŸŒ  á´á´€á´‹á´‡ á´€ á´¡Éªêœ±Êœ, á´›Êœá´‡É´ á´á´€á´‹á´‡ Éªá´› Ê€á´‡á´€ÊŸ.",
  "ðŸ—ï¸ á´›Êœá´‡ á´‹á´‡Ê á´›á´ êœ±á´œá´„á´„á´‡êœ±êœ± Éªêœ± êœ±á´›á´€Ê€á´›ÉªÉ´É¢.",
  "ðŸ† É´á´ á´„Ê€á´á´¡É´ á´¡Éªá´›Êœá´á´œá´› á´€ êœ±á´›Ê€á´œÉ¢É¢ÊŸá´‡.",
  "ðŸŒ¤ï¸ á´…á´É´â€™á´› êœ±á´›á´á´˜ á´œÉ´á´›ÉªÊŸ Êá´á´œâ€™Ê€á´‡ á´˜Ê€á´á´œá´….",
  "ðŸ¦… Ê€Éªêœ±á´‡ á´€Ê™á´á´ á´‡ á´‡á´ á´‡Ê€Ê ÊŸÉªá´Éªá´›.",

  // Sinhala Styled Quotes
  "ðŸ¤Œ â¬â¬ à¶¯Ì…à¶»à·Íœà¶œà·à¶±à·’Í¢à¶¸à·šÌ… à·ƒà·“Íœà¶¸à·à·€Í¢ à¶‰Íœà¶šà·Šà¶¸Í¢à·€à·–Ì… à¶´à·ƒà·” à¶¸à·’à¶±à·’Í¢à·ƒà·Íœ à¶´à·Šâ€à¶»Í¢à¶­à·’à¶±à·’à¶»à·ŠÍœà¶¸à·à¶«à¶ºÌ… à·€à·“à¶¸Í¢ à¶†Íœà¶»à¶¸à·Šà¶·Ì… à·€à·š â­â­",
  "â¤ï¸ â¬â¬ à¶´à¶­Í¢à¶´à·”à·”Íœ à¶¸à·’à¶±à·’Í¢à·ƒà·Šà·ƒà·”à¶¸Íœ à·„Í¢à¶¸à·” à¶‹Íœà¶±à·”Ì… à¶¯à·à¶§Í¢ à¶´à·Šâ€à¶»à·šà¶¸Íœà¶º à·„Í¢à¶»à·’ à·ƒà·”Íœà¶±à·Šà¶¯à¶»Í¢ à·€à·™à¶ºà·’ â­â­",
  "ðŸ‘Š â¬â¬ à¶”à·€à·ŠÍœ à¶¸à¶‚Ì… à·€à·™Í¢à¶±à¶ºà·’Ì… à¶¶à¶‚ à¶¸Í¢à¶œà·™ à·€Íœà¶»à·Šà¶œà·™à¶±à·ŠÍ¢ à¶‘à¶šà¶ºà·’Ì… à¶¶à¶‚ â­â­",
  "ðŸ˜¼ â¬â¬ à¶šà·™Í¢à¶½à·Šà¶½à·™à¶šà·ŠÍœ à¶¯à·à¶šà·ŠÍ¢à¶šà¶­à·ŠÍœ à¶¶à·’à¶¸Í¢ à¶¶Ì¸à¶½à¶‚Ì¶ à¶ºÍ¢à¶± à¶‘à¶šÍœ à¶¯à·à¶±à·ŠÍ¢ à¶´à·”à¶»à·”Íœà¶¯à·Šà¶¯à¶šà·ŠÌ… à·€à·™à¶½à· â­â­",
  "ðŸ˜ â¬â¬ à·€à¶­à·ŠÍ¢à¶šà¶¸à·ŠÍœ à·ƒà·™Í¢à·€à·“à¶¸à¶§Íœ à¶¶à·à¶‚Í¢à¶šà·”Íœ à¶œà·’à¶«à·”Í¢à¶¸à·Š à·„à·Íœà¶»à·“à¶¸Í¢ à¶´à·ƒà·™Íœà¶š à¶­Í¢à¶¶à·Íœ à¶¸à·…Í¢ à¶´à·ƒà·”Íœ à¶¸à¶½Í¢ à¶œà·™à¶¯Íœà¶»à¶§Í¢ à¶´à·à¶¸à·’Íœà¶«à·™à¶±à·” à·„à¶¸à·Šà¶¶Í¢à¶šà¶½Íœ à¶°Í¢à¶±à¶º à¶…Íœà¶œà·šà¶§Í¢ à¶´à·™à¶±à·™Íœà·€à·’ â­â­",
  "ðŸ¥µ â¬â¬ à¶‡Í¢à·€à·’à·ƒà·Šà·ƒà·™Íœà¶±à·Šà¶±Í¢ à¶‘à¶´à·Íœ à¶…à·€à·”Í¢à·ƒà·Šà·ƒà¶±Íœ à¶‘à¶šÍ¢ à¶¸à·šÍœ à¶œà·šÍ¢à¶¸à·Š à¶‘Í à¶šà·šÍœà¶¸ à¶šà·œà¶§Íœà·ƒà¶šà·Š â­â­",
  "ðŸ«¡ â¬â¬ à¶šÌ…à·€à·Šà¶»à·”Íœà¶­à·Š à¶¯à·Ì…à¶´à·” à·€Íœà¶ à¶± Í¢à¶­à·Ì…à¶¸à¶­à·Š à¶­à·’à¶ºÍ¢à¶±Ì…à·€à· à¶”à¶½à·”à·€à·šÌ… â­â­"
];

const jsonPath = path.join(__dirname, "autobio.json");
let bioUpdateInterval = null;

// ðŸ”¹ Load current status from JSON
const loadStatus = () => {
  if (!fs.existsSync(jsonPath)) return { enabled: false };
  const data = fs.readFileSync(jsonPath, "utf-8");
  return JSON.parse(data);
};

// ðŸ”¹ Save status to JSON
const saveStatus = (status) => fs.writeFileSync(jsonPath, JSON.stringify(status, null, 2));

const updateBio = async (conn) => {
  try {
    const currentTime = moment().tz("Asia/Colombo").format("HH:mm");
    const quote = lifeQuotes[Math.floor(Math.random() * lifeQuotes.length)];
    const newStatus = `âœ¨ < | ðá´œá´‡á´‡É´ ð‰á´œêœ±á´Ê ðŒá´… ðˆð¬ ð€á´„á´›Éªá´ á´‡ ðŸŸ¢ | â° ${currentTime} | \nðŸ’¬ â–¸ ${quote}`;
    await conn.updateProfileStatus(newStatus);
    console.log("âœ… Bio updated:", newStatus);
  } catch (err) {
    console.error("âŒ Failed to update bio:", err.message);
  }
};

// ðŸ”¹ Start auto bio interval
const startAutoBio = (conn) => {
  if (bioUpdateInterval) clearInterval(bioUpdateInterval);
  bioUpdateInterval = setInterval(() => updateBio(conn), 60000);
  updateBio(conn); // initial run
};

// ðŸ”¹ Command to toggle autobio
cmd({
  pattern: "autobio",
  desc: "Enable or disable automatic bio updates with motivational (English + Sinhala) quotes and time.",
  category: "system",
  react: "ðŸ§¬",
  use: ".autobio",
  filename: __filename,
}, async (conn, mek, m, { reply, isOwner }) => {

  if (!isOwner) return reply("â›” Only the bot owner can use this command.");
  if (config.AUTO_BIO.toLowerCase() !== "true") return reply("âŒ Auto Bio system is disabled in config.");

  const status = loadStatus();

  if (status.enabled) {
    clearInterval(bioUpdateInterval);
    bioUpdateInterval = null;
    saveStatus({ enabled: false });
    return reply("ðŸ›‘ Auto bio updates have been stopped.");
  } else {
    saveStatus({ enabled: true });
    startAutoBio(m.conn || m);
    return reply("> âœ… Auto bio update enabled..\n\n```Bot bio will update every 1 minute with current time and quotes (English + Sinhala).```");
  }
});

// ðŸ”¹ Auto start if JSON has enabled=true
cmd.ev?.on("connection.update", ({ connection }, conn) => {
  const status = loadStatus();
  if (connection === "open" && status.enabled) startAutoBio(conn);
});

module.exports = { startAutoBio };
